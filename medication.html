<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>智能用药管理 - 慢病管理 AI 智能化平台</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css">
    <link rel="stylesheet" href="../assets/css/main.css">
</head>
<body class="bg-gray-50">
    <div class="status-bar"></div>

    <!-- 顶部导航栏 -->
    <header class="bg-white shadow-sm">
        <div class="flex items-center px-4 py-3">
            <a href="home.html" class="mr-4">
                <i class="fas fa-chevron-left text-gray-600"></i>
            </a>
            <h1 class="text-lg font-semibold text-gray-800">智能用药管理</h1>
        </div>
    </header>

    <div class="page-container">
        <!-- 日期显示 -->
        <div class="px-4 py-3 bg-white shadow-sm mb-4">
            <div class="flex justify-between items-center">
                <div>
                    <h2 class="text-xl font-semibold text-gray-800" id="currentDate"></h2>
                    <p class="text-sm text-gray-600" id="currentWeekday"></p>
                </div>
                <button class="ios-button bg-green-500 hover:bg-green-600">
                    <i class="fas fa-plus mr-1"></i>添加用药
                </button>
            </div>
        </div>

        <!-- 当前用药方案 -->
        <div class="px-4 mb-6">
            <h3 class="text-lg font-semibold text-gray-800 mb-4">今日用药</h3>
            <div class="space-y-4" id="medicationList">
                <!-- 用药卡片示例 -->
                <div class="ios-card">
                    <div class="flex items-start justify-between">
                        <div class="flex-1">
                            <div class="flex items-center mb-2">
                                <div class="w-10 h-10 bg-blue-100 rounded-lg flex items-center justify-center mr-3">
                                    <i class="fas fa-pills text-blue-500"></i>
                                </div>
                                <div>
                                    <h4 class="font-medium text-gray-800">格列美脲片</h4>
                                    <p class="text-sm text-gray-600">2mg/次</p>
                                </div>
                            </div>
                            <div class="flex items-center text-sm text-gray-600">
                                <i class="far fa-clock mr-1"></i>
                                <span>每日三次，餐前服用</span>
                            </div>
                            <div class="mt-3 flex space-x-2">
                                <span class="tag tag-blue">早餐前 07:30</span>
                                <span class="tag tag-blue">午餐前 12:00</span>
                                <span class="tag tag-blue">晚餐前 18:30</span>
                            </div>
                        </div>
                        <button class="text-gray-400 hover:text-gray-600">
                            <i class="fas fa-ellipsis-v"></i>
                        </button>
                    </div>
                    <div class="mt-4 flex justify-between items-center">
                        <div class="flex space-x-4">
                            <button class="text-sm text-blue-500">
                                <i class="fas fa-bell mr-1"></i>提醒设置
                            </button>
                            <button class="text-sm text-gray-600">
                                <i class="fas fa-history mr-1"></i>服药记录
                            </button>
                        </div>
                        <button class="ios-button bg-green-500 hover:bg-green-600 text-sm px-4 py-1">
                            标记服用
                        </button>
                    </div>
                </div>

                <div class="ios-card">
                    <div class="flex items-start justify-between">
                        <div class="flex-1">
                            <div class="flex items-center mb-2">
                                <div class="w-10 h-10 bg-purple-100 rounded-lg flex items-center justify-center mr-3">
                                    <i class="fas fa-capsules text-purple-500"></i>
                                </div>
                                <div>
                                    <h4 class="font-medium text-gray-800">盐酸二甲双胍片</h4>
                                    <p class="text-sm text-gray-600">0.5g/次</p>
                                </div>
                            </div>
                            <div class="flex items-center text-sm text-gray-600">
                                <i class="far fa-clock mr-1"></i>
                                <span>每日两次，餐后服用</span>
                            </div>
                            <div class="mt-3 flex space-x-2">
                                <span class="tag tag-purple">早餐后 08:30</span>
                                <span class="tag tag-purple">晚餐后 19:30</span>
                            </div>
                        </div>
                        <button class="text-gray-400 hover:text-gray-600">
                            <i class="fas fa-ellipsis-v"></i>
                        </button>
                    </div>
                    <div class="mt-4 flex justify-between items-center">
                        <div class="flex space-x-4">
                            <button class="text-sm text-blue-500">
                                <i class="fas fa-bell mr-1"></i>提醒设置
                            </button>
                            <button class="text-sm text-gray-600">
                                <i class="fas fa-history mr-1"></i>服药记录
                            </button>
                        </div>
                        <button class="ios-button bg-gray-500 hover:bg-gray-600 text-sm px-4 py-1">
                            已服用
                        </button>
                    </div>
                </div>
            </div>
        </div>

        <!-- 用药日历 -->
        <div class="px-4">
            <h3 class="text-lg font-semibold text-gray-800 mb-4">用药日历</h3>
            <div class="ios-card">
                <div class="grid grid-cols-7 gap-2 mb-4">
                    <div class="text-center text-sm text-gray-600">日</div>
                    <div class="text-center text-sm text-gray-600">一</div>
                    <div class="text-center text-sm text-gray-600">二</div>
                    <div class="text-center text-sm text-gray-600">三</div>
                    <div class="text-center text-sm text-gray-600">四</div>
                    <div class="text-center text-sm text-gray-600">五</div>
                    <div class="text-center text-sm text-gray-600">六</div>
                </div>
                <div class="grid grid-cols-7 gap-2" id="calendar">
                    <!-- 日历单元格将通过 JavaScript 动态生成 -->
                </div>
            </div>
        </div>
    </div>

    <!-- 提醒设置模态框 -->
    <div class="modal hidden" id="reminderModal">
        <div class="modal-content">
            <div class="flex justify-between items-center mb-4">
                <h3 class="text-lg font-semibold">提醒设置</h3>
                <button class="text-gray-400 hover:text-gray-600" onclick="closeModal()">
                    <i class="fas fa-times"></i>
                </button>
            </div>
            <form id="reminderForm">
                <div class="form-group">
                    <label class="form-label">提醒时间</label>
                    <input type="time" class="ios-input" required>
                </div>
                <div class="form-group">
                    <label class="form-label">重复</label>
                    <select class="ios-input" required>
                        <option value="daily">每天</option>
                        <option value="weekdays">工作日</option>
                        <option value="custom">自定义</option>
                    </select>
                </div>
                <div class="form-group">
                    <label class="form-label">提醒方式</label>
                    <div class="space-y-2">
                        <label class="flex items-center">
                            <input type="checkbox" class="form-checkbox" checked>
                            <span class="ml-2">铃声</span>
                        </label>
                        <label class="flex items-center">
                            <input type="checkbox" class="form-checkbox" checked>
                            <span class="ml-2">振动</span>
                        </label>
                    </div>
                </div>
                <button type="submit" class="ios-button w-full mt-4">保存设置</button>
            </form>
        </div>
    </div>

    <script src="../assets/js/main.js"></script>
    <script>
        // 更新当前日期和星期
        const now = new Date();
        document.getElementById('currentDate').textContent = utils.formatDate(now);
        document.getElementById('currentWeekday').textContent = now.toLocaleDateString('zh-CN', { weekday: 'long' });

        // 生成日历
        function generateCalendar() {
            const calendar = document.getElementById('calendar');
            const today = new Date();
            const firstDay = new Date(today.getFullYear(), today.getMonth(), 1);
            const lastDay = new Date(today.getFullYear(), today.getMonth() + 1, 0);
            
            // 添加空白天数
            for (let i = 0; i < firstDay.getDay(); i++) {
                calendar.innerHTML += `<div class="h-10"></div>`;
            }

            // 添加日期
            for (let i = 1; i <= lastDay.getDate(); i++) {
                const isToday = i === today.getDate();
                const hasRecord = Math.random() > 0.3; // 模拟用药记录
                
                calendar.innerHTML += `
                    <div class="h-10 flex items-center justify-center">
                        <div class="w-8 h-8 flex items-center justify-center rounded-full
                            ${isToday ? 'bg-blue-500 text-white' : ''}
                            ${!isToday && hasRecord ? 'bg-green-100' : ''}">
                            ${i}
                            ${hasRecord && !isToday ? '<div class="w-1 h-1 bg-green-500 rounded-full absolute -bottom-1"></div>' : ''}
                        </div>
                    </div>
                `;
            }
        }

        // 显示提醒设置模态框
        function showModal() {
            document.getElementById('reminderModal').classList.remove('hidden');
        }

        // 关闭提醒设置模态框
        function closeModal() {
            document.getElementById('reminderModal').classList.add('hidden');
        }

        // 初始化页面
        generateCalendar();

        // 绑定提醒设置表单提交事件
        document.getElementById('reminderForm').addEventListener('submit', async (e) => {
            e.preventDefault();
            const loading = utils.showLoading();
            
            try {
                // 模拟保存设置
                await new Promise(resolve => setTimeout(resolve, 1000));
                utils.showToast('设置保存成功', 'success');
                closeModal();
            } catch (error) {
                utils.showToast('保存失败，请重试', 'error');
            } finally {
                utils.hideLoading(loading);
            }
        });

        // 绑定提醒设置按钮点击事件
        document.querySelectorAll('.text-blue-500').forEach(button => {
            button.addEventListener('click', showModal);
        });
    </script>
</body>
</html> 